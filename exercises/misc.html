<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Misc Exercises - The Art of Packet Crafting with Scapy</title>
                

        <!-- Custom HTML head -->
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

                <link rel="icon" href="../favicon.svg">
                        <link rel="shortcut icon" href="../favicon.png">
                <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
                <link rel="stylesheet" href="../css/print.css" media="print">
        
        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
                <link rel="stylesheet" href="../fonts/fonts.css">
        
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        
            </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><li class="part-title">The Art of Packet Crafting with Scapy</li><li class="chapter-item expanded "><a href="../intro/index.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../intro/workshop-overview.html"><strong aria-hidden="true">1.1.</strong> Workshop Overview</a></li><li class="chapter-item expanded "><a href="../intro/license.html"><strong aria-hidden="true">1.2.</strong> License</a></li><li class="chapter-item expanded "><a href="../intro/bigger_picture.html"><strong aria-hidden="true">1.3.</strong> Bigger Picture</a></li><li class="chapter-item expanded "><a href="../intro/trainers.html"><strong aria-hidden="true">1.4.</strong> Trainers</a></li><li class="chapter-item expanded "><a href="../intro/disclaimer.html"><strong aria-hidden="true">1.5.</strong> Disclaimer</a></li><li class="chapter-item expanded "><a href="../intro/feedback.html"><strong aria-hidden="true">1.6.</strong> Feedback</a></li></ol></li><li class="chapter-item expanded "><a href="../setup/index.html"><strong aria-hidden="true">2.</strong> Lab Setup</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../setup/mysterious_boxes.html"><strong aria-hidden="true">2.1.</strong> Mysterious Boxes</a></li><li class="chapter-item expanded "><a href="../setup/network-hunt.html"><strong aria-hidden="true">2.2.</strong> Network Hunt</a></li></ol></li><li class="chapter-item expanded "><a href="../networking/index.html"><strong aria-hidden="true">3.</strong> Networking Basics</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../networking/layers.html"><strong aria-hidden="true">3.1.</strong> Network Layers</a></li><li class="chapter-item expanded "><a href="../networking/socket-interface.html"><strong aria-hidden="true">3.2.</strong> Socket Interface</a></li><li class="chapter-item expanded "><a href="../networking/packet-headers.html"><strong aria-hidden="true">3.3.</strong> Packet Headers</a></li><li class="chapter-item expanded "><a href="../networking/arp.html"><strong aria-hidden="true">3.4.</strong> ARP Protocol</a></li></ol></li><li class="chapter-item expanded "><a href="../python/index.html"><strong aria-hidden="true">4.</strong> Python</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../python/python_concepts.html"><strong aria-hidden="true">4.1.</strong> Python Concepts</a></li></ol></li><li class="chapter-item expanded "><a href="../scapy/index.html"><strong aria-hidden="true">5.</strong> Scapy</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../scapy/scapy_intro.html"><strong aria-hidden="true">5.1.</strong> Scapy Intro</a></li><li class="chapter-item expanded "><a href="../scapy/scapy_modes.html"><strong aria-hidden="true">5.2.</strong> Scapy Modes</a></li><li class="chapter-item expanded "><a href="../scapy/exploring_scapy.html"><strong aria-hidden="true">5.3.</strong> Exploring Scapy</a></li><li class="chapter-item expanded "><a href="../scapy/creating_packets.html"><strong aria-hidden="true">5.4.</strong> Creating Packets</a></li><li class="chapter-item expanded "><a href="../scapy/inspecting_packets.html"><strong aria-hidden="true">5.5.</strong> Inspecting Packets</a></li><li class="chapter-item expanded "><a href="../scapy/send_revieve_packets.html"><strong aria-hidden="true">5.6.</strong> Send &amp; Recieve Packets</a></li><li class="chapter-item expanded "><a href="../scapy/import_export_data.html"><strong aria-hidden="true">5.7.</strong> Import &amp; Export Data</a></li><li class="chapter-item expanded "><a href="../scapy/sniffing.html"><strong aria-hidden="true">5.8.</strong> Sniffing</a></li></ol></li><li class="chapter-item expanded "><a href="../recon/index.html"><strong aria-hidden="true">6.</strong> Network Recon</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../recon/host_discovery.html"><strong aria-hidden="true">6.1.</strong> Host Discovery</a></li><li class="chapter-item expanded "><a href="../recon/service_discovery.html"><strong aria-hidden="true">6.2.</strong> Service Discovery</a></li><li class="chapter-item expanded "><a href="../recon/os_detection.html"><strong aria-hidden="true">6.3.</strong> OS Detection</a></li><li class="chapter-item expanded "><a href="../recon/promisc.html"><strong aria-hidden="true">6.4.</strong> Detect Promisc Mode</a></li><li class="chapter-item expanded "><a href="../recon/pcap_analysis.html"><strong aria-hidden="true">6.5.</strong> PCAP Analysis</a></li><li class="chapter-item expanded "><a href="../recon/traceroute.html"><strong aria-hidden="true">6.6.</strong> Traceroute</a></li></ol></li><li class="chapter-item expanded "><a href="../attacks/index.html"><strong aria-hidden="true">7.</strong> Network Attacks</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../attacks/cam_overflow.html"><strong aria-hidden="true">7.1.</strong> CAM Overflow Attack</a></li><li class="chapter-item expanded "><a href="../attacks/arp_spoofing.html"><strong aria-hidden="true">7.2.</strong> ARP Spoofing</a></li></ol></li><li class="chapter-item expanded "><a href="../libraries/index.html"><strong aria-hidden="true">8.</strong> Libraries</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../libraries/netaddr.html"><strong aria-hidden="true">8.1.</strong> netaddr</a></li><li class="chapter-item expanded "><a href="../libraries/netifaces.html"><strong aria-hidden="true">8.2.</strong> netifaces</a></li></ol></li><li class="chapter-item expanded "><a href="../exercises/index.html"><strong aria-hidden="true">9.</strong> Exercises</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../exercises/misc.html" class="active"><strong aria-hidden="true">9.1.</strong> Misc Exercises</a></li><li class="chapter-item expanded "><a href="../exercises/network_hunt.html"><strong aria-hidden="true">9.2.</strong> Network Hunt</a></li></ol></li><li class="chapter-item expanded "><a href="../misc/references.html"><strong aria-hidden="true">10.</strong> References</a></li></ol>            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                                                <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                                            </div>

                    <h1 class="menu-title">The Art of Packet Crafting with Scapy</h1>

                    <div class="right-buttons">
                                                <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                                                                        
                    </div>
                </div>

                                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="misc-exercises"><a class="header" href="#misc-exercises">Misc Exercises</a></h1>
<h2 id="exercise-1"><a class="header" href="#exercise-1">Exercise 1</a></h2>
<h3 id="network-sweeping"><a class="header" href="#network-sweeping">Network sweeping</a></h3>
<ul>
<li>Write a script to perform network sweeping i.e. given a IP address range, find all the machines that are alive</li>
<li>Use any of the host discovery techniques that have been discussed but ARP tends to be neat and faster on local networks</li>
</ul>
<pre><code>$ sudo python hd_tcp_syn.py 192.168.56.99-110
 192.168.56.102 is alive
 192.168.56.103 is alive
 192.168.56.107 is alive
</code></pre>
<h2 id="exercise-2"><a class="header" href="#exercise-2">Exercise 2</a></h2>
<h3 id="port-scanning"><a class="header" href="#port-scanning">Port scanning</a></h3>
<ul>
<li>Write a script to perform port scanning i.e. given an IP address, find status of ports on the machine(atleast find any open ports under 1024)</li>
<li>Use any of the port scanning techniques that have been discussed</li>
</ul>
<pre><code>$ sudo python tcp_syn_scan.py 192.168.56.107
'ftp_data    RA'
'21          RA
'ssh         SA'
'telnet      RA'
'24          RA'
</code></pre>
<h2 id="exercise-3"><a class="header" href="#exercise-3">Exercise 3</a></h2>
<h3 id="ip-id-pattern-finder"><a class="header" href="#ip-id-pattern-finder">IP ID pattern finder</a></h3>
<ul>
<li>Write a script that takes a target IP and checks for patterns in the IP ID generation</li>
<li>Basic checks include: if the IP IDs generated are: all zeros, are all constant, are all randomized or if they are incremental.</li>
</ul>
<p>Example:</p>
<pre><code>$ sudo python ipidseq.py 192.168.56.101

Target =&gt; 192.168.56.101

[+] Sending packets to the target
[+] Analyzing the IPID pattern
[*] IPID generation pattern on scanme.nmap.org is randomized
</code></pre>
<h4 id="pythonscapy-tips"><a class="header" href="#pythonscapy-tips">Python/Scapy tips:</a></h4>
<ul>
<li>Use <code>sr1</code> for sending packet and recieving first response</li>
<li>Python has in-built function <code>all()</code> that comes handy when comparing elements in list. Looking at below examples, think about how you can use it to do other comparisions.</li>
</ul>
<pre><code>&gt;&gt;&gt; lis = [0,0,0,0]
&gt;&gt;&gt; all(v == 0 for v in lis)       # Checking if all elements in list are zero
True 
</code></pre>
<pre><code>&gt;&gt;&gt; lis = [1,4,6,9,22,65,98,354]
&gt;&gt;&gt; 
&gt;&gt;&gt; all(x&lt;y for x, y in zip(lis, lis[1:]))  # Checking if the elements are in increasing order
True
</code></pre>
<h2 id="exercise-4"><a class="header" href="#exercise-4">Exercise 4</a></h2>
<h3 id="ip-id-scanner"><a class="header" href="#ip-id-scanner">IP ID scanner</a></h3>
<ul>
<li>Your might have found a potential ‘zombie’ from the previous scan</li>
<li>Write a script that takes a <code>zombie_ip</code>, <code>victim_ip</code>. <code>victim_port</code> Performs a ipid scan (Details in the notes)</li>
</ul>
<p>For more detailed discussion: Idle scan</p>
<p>Example:</p>
<pre><code>$ sudo python ipidscanner.py 192.168.56.102 192.168.56.103 4444

[+] Sending syn-ack to zombie
[+] Recording initial IPID

[+] Sending spoofed syn to victim

[+] Sending syn-ack to zombie
[+] Recording final IPID

[*] Initial IPID of zombie: 14
[*] Final IPID of zombie: 16

The port 4444 on 192.168.56.103 is open
</code></pre>
<h4 id="pythonscapy-tips-1"><a class="header" href="#pythonscapy-tips-1">Python/Scapy tips:</a></h4>
<ul>
<li>Use <code>sr1()</code> or <code>send()</code> to send packets</li>
<li>Send <code>sr1()</code> and other packet sending functions take an extra argument verbose, set <code>verbose=0</code> to avoid scapy output</li>
</ul>
<h4 id="solution"><a class="header" href="#solution">Solution</a></h4>
<p>idle scan consists of three steps that are repeated for each port:</p>
<ul>
<li>Probe the zombie’s IPID and record it. (Send a syn-ack to zombie, record ipid in response)</li>
<li>Forge a SYN packet with zombie IP as source and victim IP, victim port as destination.</li>
<li>Probe the zombie’s IP ID again. The target port state is then determined by comparing this new IP ID with the one recorded in step 1.</li>
<li>At this point, if the zombie’s IPID increased by one that the zombie hasn’t sent out any packets, except for its reply to the attacker’s probe. THis is an indication that the target port might be closed on victim.</li>
<li>If the zombie’s IPID increased by two, it means the zombie sent out a packet between the two probes. This is an indication that the target port is open on the victim.</li>
<li>If zombie IPIP increases by more than two, it usually indicates a bad zombie host. It might not have predictable IPID numbers, or might be engaged in communication unrelated to the idle scan.</li>
</ul>
<h2 id="exercise-5"><a class="header" href="#exercise-5">Exercise 5</a></h2>
<h3 id="packet-hunting"><a class="header" href="#packet-hunting">Packet hunting</a></h3>
<ul>
<li>You are given a PCAP file - <a href="https://github.com/0xbharath/art-of-packet-crafting-with-scapy/blob/master/pcaps/Boston2016.pcap">boston2016</a>, this PCAP is suspected to be having covert channel activity. (someone trying to transfer data in a packet using unsual methods)</li>
<li>Your task is to analyze this packet capture and find out the hidden data.</li>
</ul>
<h4 id="pythonscapy-tips-2"><a class="header" href="#pythonscapy-tips-2">Python/Scapy tips:</a></h4>
<ul>
<li><code>rdpcap</code> to read a pcap</li>
<li><code>packet[protocol]</code> to extract protocol specific content</li>
<li><code>packet[protocol].field</code> to extract field</li>
<li><code>format(text,'04x')</code> is how you format into proper hex format in Python.</li>
<li>Use <code>join</code> method to join elements of a list <code>&quot;.&quot;.join([192, 168, 99, 24]) –&gt; 192.168.99.24</code></li>
</ul>
<h4 id="solution-hints-i"><a class="header" href="#solution-hints-i">Solution hints I:</a></h4>
<p>This is not a packet analysis or CTF class so I’ll describe the solution in plain terms here, try to codify it using Scapy.</p>
<ul>
<li>The covert activity might be happening through UDP checksums.</li>
</ul>
<h4 id="solution-hints-ii"><a class="header" href="#solution-hints-ii">Solution hints II:</a></h4>
<p>Spoilers ahead</p>
<ul>
<li>The data is being exfiltrated by one party through checksums.</li>
<li>To be specific, UDP checksums in DNS queries is where the data is. - Extract the checksums from DNS queries.</li>
<li>You have to read the checksums in “0x:(hex) format first. format(text,'0x')</li>
<li>Decode the hex checksums into ascii and that’s the exfiltrated data.</li>
</ul>
<h2 id="exercise-6"><a class="header" href="#exercise-6">Exercise 6</a></h2>
<h3 id="packet-analysis"><a class="header" href="#packet-analysis">Packet analysis</a></h3>
<p>Given a pcap file, find all the unique hosts in that pcap file and try and determine their OS.</p>
<pre><code>$ python list_scan.py evidence.pcap

List of all the hosts and possible OS
-------------------------------------
192.168.56.0   - Linux
45.65.29.124   - Windows
198.56.101.2   - Linux
</code></pre>
<h2 id="exercise-7"><a class="header" href="#exercise-7">Exercise 7</a></h2>
<h3 id="dummy-network-scanner"><a class="header" href="#dummy-network-scanner">Dummy network scanner</a></h3>
<p>A client wants you to do a security audit on their network. Client provided you with a network range to scan and set of IP addresses to exclude from scan.</p>
<p>Before you run an actual network scan, write a script that lists all the IP addresses that falls under scan(similar to Nmap list scan). (Network range provided by client minus IP addresses to be excluded)</p>
<p>Example:</p>
<pre><code>$ python list_scan.py --range 192.168.56.1/30 --exclude 192.168.56.2
Range   =&gt; IPSet(['192.168.56.1/30'])
Exclude =&gt; IPSet(['192.168.56.2/32'])
192.168.56.0
192.168.56.1
192.168.56.3
</code></pre>
<p>Hints:</p>
<ul>
<li><code>netaddr</code> library deals with Layer 3 addressing</li>
<li><code>netaddr.IPSet</code> has a remove method to remove elements</li>
</ul>
<h2 id="exercise-8"><a class="header" href="#exercise-8">Exercise 8</a></h2>
<h3 id="local-network-interface-enumeration"><a class="header" href="#local-network-interface-enumeration">Local network interface enumeration.</a></h3>
<ul>
<li>Use a python library to list all the interfaces on your machine, find as much as you can(interface labels, addressing etc).</li>
<li>When you print the output, make sure it’s easily readable.</li>
</ul>
<p>Hints:</p>
<ul>
<li><code>netifaces</code> helps enumerate local interfaces</li>
<li><code>string .format</code> method and pprint helps you print stuff beautifully in Python</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                                                    <a rel="prev" href="../exercises/index.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        
                                                    <a rel="next" href="../exercises/network_hunt.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                                    <a rel="prev" href="../exercises/index.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                
                                    <a rel="next" href="../exercises/network_hunt.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                            </nav>

        </div>

        
        
        
                <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        
        
                <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        
        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        
        
    </body>
</html>
